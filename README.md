# bilibili-Vtuber-danmaku

Vtuberç›´æ’­é—´çš„å¼¹å¹•å“Ÿ

### JSON

```javascript
const { rooms, records, roomsRecords, read } = require('./json')
// ä»¥ä¸Šå…¨éƒ¨éƒ½æ˜¯async/Promise
```

#### rooms()

è¿”å›Array, å†…å®¹æ˜¯æˆ¿é—´åˆ—è¡¨

```javascript
rooms()
// [
//   "10143",
//   "10209381",
//   "102153",
//   ...
// ]
```

#### records(roomid)

* roomid: æˆ¿é—´å·

è¿”å›Array, å†…å®¹æ˜¯è¯¥æˆ¿é—´æ‰€æœ‰è®°å½•çš„ç›®å½•

```javascript
records(12235923)
// [
//   '2019-5-10', '2019-5-11',
//   '2019-5-12', '2019-5-13',
//   '2019-5-14', '2019-5-15',
//   ...
// ]
```

#### roomsRecords()

è¿”å›Object, å†…å®¹æ˜¯æ‰€æœ‰æˆ¿é—´ä»¥åŠæˆ¿é—´ç›®å½•, rooms+records

```javascript
roomsRecords(12235923)
// {
//   '10143': [
//     '2019-5-17',
//     '2019-5-20',
//     '2019-5-27',
//     '2019-5-29',
//     '2019-5-30',
//     '2019-5-31'
//   ],
//   '10317': [ '2019-5-31', '2019-6-1' ],
//   '14893': [
//     '2019-5-10', '2019-5-11',
//     '2019-5-12', '2019-5-13',
//     '2019-5-14', '2019-5-15',
//     ...
// }
```

#### read(roomid, date)

* roomid: æˆ¿é—´å·
* date: å¹´-æœˆ-æ—¥

è¯»å–TXTå¹¶è¿›è¡Œä¸€äº›åˆ†æ

```javascript
read(12235923, '2019-6-4')
// {
//   danmaku: [
//     { time: 0, mid: 14501198, text: 'æŒ¤è¿›å»æ‰“å“­å¥¹' },
//     { time: 0, mid: 9175795, text: 'è‰ï¼Œæ ¹æœ¬æŒ¤ä¸è¿›å»' },
//     { time: 0, mid: 13586622, text: 'foooooooo' },
//     ...
//   ],
//   raw: ...
//   speakers: {
//     '2514': { speakerNum: 1, uname: 'lostsoul' },
//     '4955': { speakerNum: 55, uname: 'çº±å¸ƒä¸' },
//     '35712': { speakerNum: 8, uname: 'aLIE_w' },
//     ...
//   },
//   online: [
//     1, 1, 1,
//     1, 1, 1,
//     ...
//   ],
//   speakerNum: 140
// }
```

å…¶ä¸­æ•°æ®çš„æ„æ€:

* danmaku: Array, æ–‡æ¡£ä¸­çš„æ‰€æœ‰å¼¹å¹•
  * time: å•ä½åˆ†é’Ÿ, ä»ä»Šå¤©0:0ç®—èµ·å‘é€å¼¹å¹•çš„æ—¶é—´
  * mid: å‘é€è€…mid
  * text: å¼¹å¹•æ–‡æœ¬
* speakers: Object, å‘è¿‡å¼¹å¹•çš„äºº, Key=mid
  * speakerNum: å‘äº†å‡ æ¡å¼¹å¹•
  * uname: ç”¨æˆ·å
* online: Array, é•¿åº¦ä¸º 1440, è®°å½•æ¯åˆ†é’Ÿçš„äººæ°”, æ²¡å¼€æ’­æ—¶ä¸º1
* speakerNum: æ€»å‘è¨€äººæ•°, å…¶å®æ˜¯ `Object.keys(speakers).length`
* raw: txtçš„æ–‡æœ¬

### Socket.io

https://api.vtbs.moe/vds

```javascript
const io = require('socket.io-client')
const socket = io('https://api.vtbs.moe/vds')
```

#### è®¢é˜… (join)

```javascript
socket.emit('join', roomid) // è®¢é˜…ç‰¹å®šæˆ¿é—´
socket.emit('join', 'all')  // è®¢é˜…æ‰€æœ‰æˆ¿é—´ 
```

#### å–æ¶ˆè®¢é˜… (leave)

```javascript
socket.emit('leave', roomid) // å–æ¶ˆè®¢é˜…ç‰¹å®šæˆ¿é—´
socket.emit('leave', 'all')  // å–æ¶ˆè®¢é˜…æ‰€æœ‰æˆ¿é—´ 
```

æ³¨æ„ï¼šè®¢é˜…äº†ä¸€éƒ¨åˆ†æˆ¿é—´ä¹‹åå–æ¶ˆè®¢é˜… `all` å¹¶ä¸ä¼šå–æ¶ˆæ‰€æœ‰æˆ¿é—´ï¼Œåªä¼šå–æ¶ˆä¹‹å‰è®¢é˜…çš„ `all`ã€‚

#### å¼¹å¹•äº‹ä»¶

```javascript
socket.on('danmaku', console.log)
// {message: "233", roomid: 12235923, mid: 3499295}
```

### Raw:TXTæ ¼å¼

#### å¼¹å¹•

çº¯æ–‡æœ¬ï¼Œè®°å½•å‘é€è€…ä¿¡æ¯

`[mid]:[text]`

#### æ—¶é—´æˆ³

`TIME[x:x]ONLINE[number]`

å¦‚ `TIME2:3ONLINE397`: å‡Œæ™¨2:3, äººæ°”397

#### å‘é€äººæ•°ç»Ÿè®¡

æ¯å¤©ç»“æŸæ—¶åœ¨æ–‡ä»¶ç»“å°¾ç»Ÿè®¡`SPEAKERNUM[x];[mid]:[uname]:[x], ...`

### å¿«æ·é“¾æ¥:

* Project Paryi
  * å¸•é‡Œ\_Paryi: [4895312](4895312)
  * ãƒ¦ãƒ¡ãƒã‚·ã‚ªãƒª: [14052636](14052636)
  * ç¥æ¥½ã‚ã‚Official: [12235923](12235923)
  * åƒè‰ã¯ãª: [12770821](12770821)
  * æ£®æ°¸ã¿ã†official: [7962050](7962050)
  * æœ‰æ –ãƒãƒŠOfficial: [3822389](3822389)
  * é«˜æ§»å¾‹official: [947447](947447)
  * èŠ±åœ’ã‚»ãƒ¬ãƒŠOfficial: [14327465](14327465)
  * ENAì—ë‚˜: [6632844](6632844)
* Chukolala
  * ä¹™å¥³ãŠã¨æ¬è¿ç»„: [21320551](21320551)
  * ä¾†å¤¢ã‚ã‚‹ã¨æ¬è¿ç»„: [4078398](4078398)
  * ç¶´ç›®æ—¥å‚˜æ¬è¿ç»„: [21320281](21320281)
  * åƒéˆ´ã‚ã„æ¬è¿ç»„: [180784](180784)
  * å¤å®ˆã¡ã‚†: [8725120](8725120)
  * æšã¡ã‚ãæ¬è¿ç»„: [262755](262755)
* Homolive
  * çŠ¬å±±ç‰å§¬Official: [4634167](4634167)
* hololive: [8982686](8982686)
  * æ—¶ä¹ƒç©ºOfficial: [8899503](8899503)
  * èåœå­Official: [4664126](4664126)
  * æ¨±å·«å¥³Official: [21144047](21144047)
  * å¤œç©ºæ¢…éœ²Official: [21131813](21131813)
  * äºšç»®-ç½—æ£®Official: [21219990](21219990)
  * èµ¤äº•å¿ƒOfficial: [14275133](14275133)
  * ç™½ä¸Šå¹é›ªOfficial: [11588230](11588230)
  * å¤è‰²ç¥­Official: [13946381](13946381)
  * æ¹Š-é˜¿åº“å¨…Official: [14917277](14917277)
  * ç´«å’²è¯—éŸ³Official: [21132965](21132965)
  * ç™¾é¬¼ç»«ç›®Official: [21130785](21130785)
  * ç™’æœˆå·§å¯Official: [21107534](21107534)
  * å¤§ç©ºæ˜´Official: [21129632](21129632)
  * å¤§ç¥æ¾ªOfficial: [21133979](21133979)
* AIchannelæ¬è¿: [1485080](1485080)
* ENTUM
  * æœªæ¥æ˜-MiraiAkari: [6792401](6792401)
  * çŒ«å®«æ—¥å‘Official: [9286381](9286381)
  * ã‚‚ã¡ã²ã‚ˆã“Official: [3657657](3657657)
* ğŸ”¨
  * Overidea\_China: [704808](704808)
* è™šæ‹Ÿå¥³å‹Yomemi: [10363055](10363055)
* sora4
  * ç™½éŸ³å°é›ªOfficial: [6241497](6241497)
* Winks
  * é™†å©‰è¹GodRiku: [11575621](11575621)
  * æƒºå¿ªå–µXingsongmiao: [13990746](13990746)
  * æ”¾é£é¸½å­£æ¯…: [13990730](13990730)
  * è™šæ‹Ÿæ‚è‰èŠ±éŸ³æ°: [13973403](13973403)
  * é˜¿ä¿®ã‚¢ãƒƒã‚·ãƒ¥: [13982579](13982579)
  * äºå·æµä¸¹çœŸçš„å¤ªå¯çˆ±äº†: [13993127](13993127)
    * é˜¿Aç”Ÿæ°å¤ªé˜³é±¼: [5193796](5193796)
    * é¸ å­ã¯ã¨ã“: [160683](160683)
  * è‰å§¬æ˜¯å¥³ç‹: [15142311](15142311)
  * çˆ±å¤ãªã¤: [3889934](3889934)
  * åˆé¢œå¤§å¯çˆ±: [15162482](15162482)
  * å¥ˆå­Nakooo: [15157903](15157903)
  * éŸ³ä»™å•: [15096239](15096239)
* Winks Extra
  * é’ŸæŒ\_è™šæ‹Ÿè¯´ä¹¦ç‹‚æˆ˜å£«: [16784](16784)
  * JKå°äºš: [13917541](13917541)
  * é¬¼æœˆOfficial: [5506769](5506769)
* KMNHZ
  * KMNHZ-China: [7688266](7688266)
* Office339
  * è™šæ‹ŸDD: [7934153](7934153)
  * JJ-Official: [14650485](14650485)
  * è™šæ‹Ÿå®«å®«Official: [1676221](1676221)
* Unlimited
  * æ¸¸æˆéƒ¨ä¼åˆ’official: [6586670](6586670)
* 2434
  * æ¤åå”¯åOfficial: [21302469](21302469)
  * ç»¿ä»™Official: [21302479](21302479)
  * æœ¬é—´å‘æ—¥è‘µOfficial: [21302477](21302477)
  * é™å‡›Official: [21302352](21302352)
  * å§”å‘˜é•¿æ‚é±¼æ¬è¿: [278936](278936)
  * æ¨‹å£æ«çš„æ«æ ‘æ—: [12492310](12492310)
  * ç«œèƒ†å°Šæ¬è¿ç»„: [14892076](14892076)
  * å¡å¡”å°¼äºšå·²æ¯•ä¸š: [31634](31634)
* èµ¤æ˜Ÿå…±å’Œå›½é€£é‚¦Channel: [24276](24276)
* THE MOON STUDIO
  * è¼å¤œæœˆOfficial: [7602132](7602132)
  * PPHOfficial: [21402105](21402105)
* Lucca Project
  * ä¹Œæ‹‰ã®å¸å›½Official: [14893](14893)
  * å–€ç§‹èç§‹æ˜Official: [2610619](2610619)
  * è¨èæŸ¯é‡Œå…‹Official: [21318294](21318294)
* SOW
  * ç±³èãƒŸã‚µOfficial: [21361292](21361292)
  * è²å¨œå¤šè²ä½Official: [21316325](21316325)
  * å‡›æ˜ŸChannel: [14507014](14507014)
  * ItaChannel: [27651](27651)
  * è²“é‡å¥ˆæœ¨Official: [2289415](2289415)
  * ç¶¾å¥ˆãªãª: [337374](337374)
  * æ˜Ÿãƒè°·ã¿ã‚„Official: [21344122](21344122)
  * Riztech: [58896](58896)
  * ç–¯ç‹‚winkç³»çœ è‘‰ç´º: [21240069](21240069)
  * è‰¾éº—å¡ãƒ»ã‚¨ãƒªã‚«ãƒãƒ£ãƒ³: [802169](802169)
  * è‰å±¥è™«Para: [6873375](6873375)
  * è¿™æ˜¯ä¸€åªYY: [10317](10317)
  * é˜¿å¾·ç½—ä¼Š-åŸƒè²å°”å¾·: [801354](801354)
* HoderAstra
  * çŸ¢æ³½å¤§å‡¤Channel: [21208533](21208533)
  * é‡‘ä¸è“æŸ“Channel: [4100246](4100246)
  * Plutyaæ™®éœ²æäºš: [1865305](1865305)
* Chucolala
  * çœç™½ã‹ã®ã‚“æ¬è¿ç»„: [21402309](21402309)
  * ç·‹èµ¤ã‚¨ãƒªã‚ªæ¬è¿ç»„: [21396545](21396545)
* HoneyStrap
  * å‘¨é˜²ãƒ‘ãƒˆãƒ©æ¬è¿: [15043003](15043003)
  * è¥¿åœ’å¯ºãƒ¡ã‚¢ãƒªæ¬é‹: [304420](304420)
* Animare æœ‰é–‘å–«èŒ¶ã‚ã«ã¾ãƒ¼ã‚Œ
  * å®‡æ£®ã²ãªã“ç‹å›½é‹æ¬: [11672349](11672349)
  * AnMræµ·å¤–è½¬æ’­Channel: [13289738](13289738)
* è™šç ”ç¤¾
  * å¹½çµå­è¾°: [40529](40529)
* æ— æ‰€å±/æ— ç»†åˆ† (æ‡’)
  * ç¥æ¥½ä¸ƒå¥ˆOfficial: [21304638](21304638)
  * æ¸…éœ²ã‚¤ã‚¯ãƒŠæ¬è¿ç»„: [21327595](21327595)
  * YuNi\_Channel: [11110277](11110277)
  * é’å®¶å¤§é™¢: [4657471](4657471)
  * æˆ˜æ–—å§æ­Œå§¬å®˜æ–¹è´¦å·: [14578426](14578426)
  * é­”å®µã•ãã‚…Official: [1321846](1321846)
  * ç‰©è¿°æœ‰æ –-çˆ±ä¸½ä¸æ¬è¿: [9680769](9680769)
  * æ˜¯å­å½§å–: [510409](510409)
  * ç»‡ç”°ä¿¡å§¬official: [11933197](11933197)
  * ç¥ç€-è™šé¢œ: [4632617](4632617)
  * 8911å‹˜æµ‹ç ”ç©¶æ‰€: [894919](894919)
  * è™šæ‹Ÿæ¬¡å…ƒè®¡åˆ’: [4138602](4138602)
  * å…½è€³æ”¾é€: [11631906](11631906)
  * Mendakoé†¤Official: [21195793](21195793)
  * ç«¹è½®å–µOfficial: [21357592](21357592)
  * ä¹å–µChannel: [284685](284685)
  * å®‰å ‚ã„ãªã‚Š\_official: [21224291](21224291)
  * æŸšå”§ã®å¾®å…‰å°å‰§åœº: [21338753](21338753)
  * å¿ƒæ–æ¡¥ã‚ªã‚¯ãƒˆOfficial: [3827429](3827429)
  * æç¨ç‰™ç‰™èª: [729794](729794)
  * Siva\_å°è™¾é±¼\_: [13576775](13576775)
  * å…°è‹¥\_Re: [14110147](14110147)
  * å¥³å·«Vivian: [14239687](14239687)
  * æ±é›²æµOfficial: [10358807](10358807)
  * ç”µè„‘å°‘å¥³siro\_å°ç™½: [21307497](21307497)
  * ç´™æœ¨å§å¦¹Official: [21288388](21288388)
  * æœ¨ç³–çº¯å’Œåº„ä¸çº¯: [919919](919919)
  * æ‘©æ\_MoChi: [21116901](21116901)
  * è’¼ä¹ƒå¹½å§¬: [21254047](21254047)
  * RukiRokiChannel: [21346226](21346226)
  * å…°è‹¥\_Ruo: [12386041](12386041)
  * Kanna\_åº·å¨œOfficial: [14222920](14222920)
  * ç”°ä¸­å§¬é“ƒæœ¨é›Official: [10209381](10209381)
  * ç™½é“åäºŒå®«å’Œå·´æ°é²: [21147578](21147578)
  * shugen: [912226](912226)
  * å¤©ç¥å­å…”éŸ³Official: [13744134](13744134)
  * AZKi\_Official: [21267062](21267062)
  * æ¶‰è°·HAL\_official: [21391318](21391318)
  * éŸ³ä¿£ã‚‹ã‹é‹æ¬çµ„: [21317030](21317030)
  * è¿›å‡»çš„å†°ç³–: [876396](876396)
  * é™½å‘ã“ã“ã¿Official: [566227](566227)
  * é›ªåŸçœŸå°‹æ¬é‹çµ„: [21390586](21390586)
  * æ°´æ¼ è±†è…: [895206](895206)
  * æ—¥æœˆå’ªç‰-å®˜æ–¹: [21300316](21300316)
  * èŠ±èŠ½å§å¦¹Official: [15065340](15065340)
  * æ·ºç¾½Asaha\_Mino: [7170879](7170879)
  * ç«¹å–ã‹ã‚‹ãŸæ¬è¿ç»„: [21252047](21252047)
  * æ˜Ÿç©ºæ‚ Channel: [11493013](11493013)
  * RiNE\_Channel: [1305231](1305231)
  * æ¨±ç¾Yuna-Official: [43822](43822)
  * ä¸ƒæ¿‘èƒ¡æ¡ƒmenherachan: [11754098](11754098)
